const{createApp:createApp}=Vue,cartApp=createApp({data:()=>({cart:null,total:null,cartCount:0,isEmpty:!0,loader:!0,coupon:null,couponIsEmpty:!0}),methods:{updateCart:function(){this.loader=!0;let t=new FormData;t.append("action","cart_action"),t.append("details","get_cart"),axios({method:"post",url:"/wp-admin/admin-ajax.php",data:t}).then((t=>{let e=t.data;0!=e.cart.count?this.isEmpty=!0:this.isEmpty=!1,this.cartCount=Number(e.cart.count),this.total=Number(e.cart.total),this.cart=e.cart.products,this.loader=!1,Object.keys(e.cart.coupons).length&&(this.coupon=e.cart.coupons,this.couponIsEmpty=!1)})).catch((t=>{console.log(t)}))},addToCart:function(t,e,a=null,o,c=null){this.loader=!0;let r=c,n=new FormData;n.append("action","cart_action"),n.append("details","add_to_cart"),n.append("product_id",e),n.append("qnt",o),!0===t&&null!=a&&n.append("variation_id",a),axios({method:"post",url:"/wp-admin/admin-ajax.php",data:n}).then((t=>{let e=t.data;0!=e.cart.count?this.isEmpty=!0:this.isEmpty=!1,this.cartCount=Number(e.cart.count),this.total=Number(e.cart.total),this.cart=e.cart.products,this.loader=!1,Object.keys(e.cart.coupons).length&&(this.coupon=e.cart.coupons,this.couponIsEmpty=!1);let a=document.getElementById(r);a.style.backgroundColor="green",a.textContent="Додано!"})).catch((t=>{console.log(t)}))},removeFromCart:function(t){this.loader=!0;let e=new FormData;e.append("action","cart_action"),e.append("details","remove_from_cart"),e.append("item",t),axios({method:"post",url:"/wp-admin/admin-ajax.php",data:e}).then((t=>{let e=t.data;0!=e.cart.count?this.isEmpty=!0:this.isEmpty=!1,this.cartCount=Number(e.cart.count),this.total=Number(e.cart.total),this.cart=e.cart.products,this.loader=!1,Object.keys(e.cart.coupons).length&&(this.coupon=e.cart.coupons,this.couponIsEmpty=!1)})).catch((t=>{console.log(t)}))},openCart:function(){const t=document.querySelector(".cart-block"),e=document.querySelector(".cart-bg");t.classList.toggle("cart-block-open"),e.classList.toggle("cart-bg-open"),document.body.classList.toggle("no-scroll")},closeCart:function(){const t=document.querySelector(".cart-block"),e=document.querySelector(".cart-bg");t.classList.remove("cart-block-open"),e.classList.remove("cart-bg-open"),document.body.classList.remove("no-scroll")},qntItemPlus:function(t){this.loader=!0;let e=new FormData;e.append("action","cart_action"),e.append("details","item_plus"),e.append("index",t),axios({method:"post",url:"/wp-admin/admin-ajax.php",data:e}).then((t=>{let e=t.data;0!=e.cart.count?this.isEmpty=!0:this.isEmpty=!1,this.cartCount=Number(e.cart.count),this.total=Number(e.cart.total),this.cart=e.cart.products,this.loader=!1,Object.keys(e.cart.coupons).length&&(this.coupon=e.cart.coupons,this.couponIsEmpty=!1)})).catch((t=>{console.log(t)}))},qntItemMinus:function(t){this.loader=!0;let e=new FormData;e.append("action","cart_action"),e.append("details","item_minus"),e.append("index",t),axios({method:"post",url:"/wp-admin/admin-ajax.php",data:e}).then((t=>{let e=t.data;0!=e.cart.count?this.isEmpty=!0:this.isEmpty=!1,this.cartCount=Number(e.cart.count),this.total=Number(e.cart.total),this.cart=e.cart.products,this.loader=!1,Object.keys(e.cart.coupons).length&&(this.coupon=e.cart.coupons,this.couponIsEmpty=!1)})).catch((t=>{console.log(t)}))}},mounted:function(){this.updateCart()}}).mount("#cart-container");let addToCartBtn=document.querySelectorAll(".woocommerce-variation-add-to-cart .add-btn, .simple_form .add-btn");addToCartBtn.forEach((t=>{t.addEventListener("click",(function(e){e.preventDefault();let a=this.id,o=this.textContent,c=this.style.backgroundColor,r=t.closest("form"),n=t.closest(".woocommerce-variation-add-to-cart");if("simple"===t.getAttribute("data-type")||!n.classList.contains("woocommerce-variation-add-to-cart-disabled")){let e,n=r.querySelector("input[name=product_id]").value;null!=r.querySelector("input[name=variation_id]")&&(e=r.querySelector("input[name=variation_id]").value);let i=r.querySelector("input[name=quantity]").value;void 0!==n&&(t.style.backgroundColor="gray",t.setAttribute("disabled",!0),t.textContent="Додаємо...",void 0!==e?cartApp.addToCart(!0,n,e,i,a):cartApp.addToCart(!0,n,null,i,a),setTimeout((function(){r.reset(),btnFastPurchase=r.querySelector(".purchase-onclick"),btnFastPurchase.classList.contains("simple_product")||btnFastPurchase.setAttribute("disabled",!0),t.textContent=o,t.removeAttribute("disabled"),t.style.backgroundColor=c}),5e3))}}))}));let form=document.querySelector(".variations_form");function findVariation(t){let e=document.querySelector(".variations_form").getAttribute("data-vars"),a=JSON.parse(e),o=[];for(const[e,a]of Object.entries(t))o["attribute_"+e]=a.value;let c=null;if(1==a.length)c=a[0];else{for(const[t,e]of Object.entries(o))a.forEach(((t,o)=>{Object.values(t.attributes).indexOf(e)>-1||delete a[o]}));a.forEach(((t,e)=>{c=t}))}return c}null!==form&&form.addEventListener("change",(function(t){let e=JSON.parse(form.getAttribute("data-keys")),a=[];e.forEach((t=>{let e={status:!1,value:null};document.getElementById(t).querySelectorAll("input[type=radio]").forEach((t=>{!0===t.checked&&(e.status=!0,e.value=t.value)})),a[t]=e}));const o=Object.values(a).every((t=>!0===t.status));let c=form.querySelector("input[name=variation_id]"),r=form.querySelector(".woocommerce-variation-add-to-cart"),n=r.querySelector(".add-btn"),i=r.querySelector(".purchase-onclick"),s=document.querySelector(".prices .new-price"),l=null;if(!0===o&&(l=findVariation(a)),null!=l){let t=l.variation_id;s.textContent=l.display_price+" грн.",s.setAttribute("data-product-price",l.display_price+" грн."),c.value=t,r.classList.remove("woocommerce-variation-add-to-cart-disabled"),r.classList.add("woocommerce-variation-add-to-cart-enabled"),n.classList.remove("disabled"),n.classList.remove("wc-variation-selection-needed"),i.removeAttribute("disabled")}}));
